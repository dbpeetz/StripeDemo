@model StripeDemo.Models.IndexViewModels
@{
    ViewBag.Title = "Custom";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Content/Site.css" rel="stylesheet" />
<div class="container-fluid">
    <div class="content-wrapper" style="margin-top:auto">
        <div class="item-container">
            <div class="container"style="margin-top:100px">
                <div class="col-md-12"style="margin-top:20px">
                    <div class="product col-md-3 service-image-left">

                        <center>
                            <img id="item-display" src="~/Content/img/7724415001S_Garrett.1.jpg" alt=""></img>
                        </center>
                    </div>

                    <div class="container service1-items col-sm-2 col-md-2 pull-left">
                        <center>
                            <a id="item-1" class="service1-item">
                                <img src="~/Content/img/7724415001S_Garrett.1.jpg" alt="">
                            </a>
                            <a id="item-2" class="service1-item">
                                <img src="~/Content/img/7724415001S_Garrett_2.jpg" alt="">
                            </a>
                            <a id="item-3" class="service1-item">
                                <img src="~/Content/img/7724415001S_Garrett_3.jpg" alt="">
                            </a>
                        </center>
                    </div>
                </div>

                <div class="col-md-7">
                    <div class="product-title">Garett GT3788VA</div>
                    <div class="product-desc">"Drop-in Upgrade" for 2004.5-2007 6.0L Powerstroke</div>
                    <div class="product-rating"><i class="fa fa-star gold"></i> <i class="fa fa-star gold"></i> <i class="fa fa-star gold"></i> <i class="fa fa-star gold"></i> <i class="fa fa-star-o"></i> </div>
                    <hr>
                    <div class="product-price">$ 1234.00</div>
                    <div class="product-stock">In Stock</div>
                    <hr>
                    <div class="btn-group cart">
                        <button id="pay-button" type="submit" class="btn btn-success  btn-product"><span class="glyphicon glyphicon-shopping-cart"></span> Pay with Card</button>
                    </div>
                    <div class="btn-group wishlist">
                        <button type="button" class="btn btn-danger">
                            Add to wishlist
                        </button>
                    </div>

                    <div id="payment-form-container" class="col-md-6 well hidden">

                        <form id="payment-form" action="/Book/Charge" method="post" class="cardInfo" accept-charset="UTF-8" novalidate autocomplete="on">

                            <div class="form-group">
                                <label class="control-label">Accepted</label>
                                <div class="row">
                                    <div class="col-md-10 card-images">
                                        <img src="~/Content/img/creditcards/visa.png" alt="visa" />
                                        <img src="~/Content/img/creditcards/mastercard.png" alt="mastercard" />
                                        <img src="~/Content/img/creditcards/amex.png" alt="amex" />
                                        <img src="~/Content/img/creditcards/discover.png" alt="discover" />
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="cc-number" class="control-label">Card Number</label>
                                <div class="input-group col-md-6">

                                    <input id="cc-number" data-stripe="number" type="tel" class="input-lg form-control cc-number" autocomplete="cc-number" placeholder="•••• •••• •••• ••••" required autofocus>
                                    <span class="glyphicon glyphicon-credit-card glyphicon-align-right form-control-feedback" aria-hidden="true"></span>
                                </div>

                            </div>

                            <div class="row">

                                <div class="form-group col-md-4">
                                    <label for="cc-exp" class="control-label">Expires</label>
                                    <input id="cc-exp" data-stripe="exp" type="tel" class="input-lg form-control cc-exp" placeholder="MM / YY" required>
                                </div>

                                <div class="form-group col-md-3 ">
                                    <label for="cc-cvc" class="control-label">CVC</label>
                                    <input id="cc-cvc" data-stripe="cvc" type="tel" class="input-lg form-control cc-cvc" autocomplete="off" placeholder="•••" required>
                                    <span class="glyphicon glyphicon-lock  form-control-feedback" aria-hidden="true"></span>
                                </div>

                            </div>

                            <div class="form-group">
                                <label for="email" class="control-label">Email</label>
                                <div class="input-group col-md-6">

                                    <input id="email" type="email" name="stripeEmail" class="input-lg form-control email" placeholder="Email" required>
                                    <span class="glyphicon glyphicon-envelope glyphicon-align-right form-control-feedback" aria-hidden="true"></span>
                                </div>

                            </div>

                            <div class="row">
                                <div class="form-group col-md-6  ">
                                    <button type="submit" class="btn btn-success  btn-product"><span class="glyphicon glyphicon-shopping-cart"></span> Buy</button>
                                </div>
                            </div>

                            <h3 class="validation"></h3>
                            <p class="alert alert-danger payment-errors" style="display:none; "></p>
                        </form>

                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="col-md-12 product-info">
                <ul id="myTab" class="nav nav-tabs nav_tabs">

                    <li class="active"><a href="#service-one" data-toggle="tab">DESCRIPTION</a></li>
                    <li><a href="#service-two" data-toggle="tab">PRODUCT INFO</a></li>
                    <li><a href="#service-three" data-toggle="tab">REVIEWS</a></li>

                </ul>
                <div id="myTabContent" class="tab-content">
                    <div class="tab-pane fade in active" id="service-one">

                        <section class="container product-info">
                            The Corsair Gaming Series GS600 power supply is the ideal price-performance solution for building or upgrading a Gaming PC. A single +12V rail provides up to 48A of reliable, continuous power for multi-core gaming PCs with multiple graphics cards. The ultra-quiet, dual ball-bearing fan automatically adjusts its speed according to temperature, so it will never intrude on your music and games. Blue LEDs bathe the transparent fan blades in a cool glow. Not feeling blue? You can turn off the lighting with the press of a button.

                            <h3>Garrett GT3788 Features:</h3>
                            <li>Designed as a "drop-in upgrade", the GT3788A retain use of factory components.
                             Such as engine electronics, mounting pedestal and requires no additional modifications.</li>
                            <li>Features the Garrett® patented Advanced Variable Nozzle Turbine (AVNTTM) design for increased compressor
                                flow and boost response</li>
                            <li>Utilizes nine movable vanes which significantly increase turbine efficiency and improve engine
                                performance from idle launch through peak torque</li>
                            <li>Patented integral electro-hydraulic actuation and proportional solenoid for infinitely variable control
                                Larger compressor wheel over stock increases maximum power range while keeping turbo speeds down for the
                                same power output</li>
                            <li>Supports up to an additional 175 HP over stock with no sacrifice in drivability</li>
                        </section>

                    </div>
                    <div class="tab-pane fade" id="service-two">

                        <section class="container"></section>

                    </div>
                    <div class="tab-pane fade" id="service-three">

                    </div>
                </div>
                <hr>
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
    <script type="text/javascript" src="~/Scripts/payment-validations.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery.payment.js"></script>

    <script type="text/javascript">
    Stripe.setPublishableKey("@Model.StripePublishableKey");

    jQuery(function ($) {

        $("#pay-button").click(function (e) {
            $("#payment-form-container").toggleClass("hidden");
        });

        $('#payment-form').submit(function (e) {
            e.preventDefault();
            var $form = $(this);

            // Disable the submit button to prevent repeated clicks
            $form.find('button').prop('disabled', true);

            //Stripe.card.createToken($form, stripeResponseHandler);
            expiration = $('.cc-exp').payment('cardExpiryVal');
            Stripe.card.createToken({
                number: $('.cc-number').val(),
                cvc: $('.cc-cvc').val(),
                exp_month: (expiration.month || 0),
                exp_year: (expiration.year || 0)
            }, stripeResponseHandler);

        });

        stripeResponseHandler = function (status, response) {
            var $form = $('#payment-form');

            if (response.error) {
                // Show the errors on the form
                $paymentErrors = $form.find('.payment-errors');
                $paymentErrors.text(response.error.message);
                $paymentErrors.toggle($paymentErrors.text.length > 0);

                $form.find('button').prop('disabled', false);
            } else {
                // token contains id, last4, and card type
                var token = response.id;
                // Insert the token into the form so it gets submitted to the server
                $form.append($('<input type="hidden" name="stripeToken" />').val(token));
                // and re-submit
                $form.get(0).submit();
            }
        };




    });
    </script>
    }
